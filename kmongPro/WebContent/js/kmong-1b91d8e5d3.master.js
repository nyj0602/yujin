var master_vue=new Vue({el:"#master_body",data:{isLoggedIn:!1,notifications:[],gig_request_id:null,page:1,unreadCnt:0,isRequest:!1,is_lastPage:!1,buyUnreadCount:0,sellUnreadCount:0,isInit:!1,kmong_notifications:[],kmongNotificationCurrentPage:1,kmongNotificationLoading:!1,kmongNotificationIsLastPage:!1,selectedIndex:-1,selectedKmongNotification:null,selectedKmongNotificationParameters:null,is_lastPage_kmong_noti:!1,loadingNotification:!1,unreadKmongNotificationCount:0,isShowUnreadNotification:!1,knowledge_bases:[],kb_query:null,kb_search_result:[],knowledge_base_detail:null,helpCenterForm:{from_email:"",title:"",body:"",files:[]},isShowNetPromoterScoreSurvey:-1,netPromoterScore:{question_id:null,score:-1,check:"",message:""},netPromoterScoreQuestions:[],isFirstGetCurrentViewedGigs:!1,currentViewedGigs:[],isAnimatingBuyerVideoCarousel:!1},ready:function(){var e=$("#kmongKnowledgeBase"),t=$("#kmongKnowledgeBase .carousel-inner .item"),i=$("#kmongNotificationDetailBody"),o=$("#kmongNotificationDetailLoadingBody"),n=$("#kbCategoryBody"),s=$(window);e.css({height:s.height()}),t.css({height:s.height()}),i.css({height:s.height()-55-40}),o.css({height:s.height()-40}),n.css({height:s.height()-40}),n.mousewheelStopPropagation(),i.mousewheelStopPropagation(),s.resize(function(){e.css({height:s.height()}),t.css({height:s.height()}),i.css({height:s.height()-55-40}),o.css({height:s.height()-40}),n.css({height:s.height()-40})});var r=$("#buyerVideoCarousel");r.length>0&&r.on("slid.bs.carousel",function(){master_vue.isAnimatingBuyerVideoCarousel=!1}),this.client=algoliasearch("A04GWTTBY5","c3cfa193bab9365c228a52ecaf996123"),this.index=this.client.initIndex("knowledge_bases"),$(".kb_search_bar").typeahead({hint:!1,minLength:2,classNames:{dataset:"list-group margin-none",suggestion:"list-group-item border-radius-none kmong-kb-search cursor"}},{source:this.index.ttAdapter({}),displayKey:"title",templates:{suggestion:function(e){return"<span>"+e.title+"</span>"}}}).on("typeahead:select",function(e,t){master_vue.kb_query=t.title,master_vue.searchKB()}).on("typeahead:close",function(){master_vue.kb_search_result=[]}.bind(this)),Dropzone.autoDiscover=!0;var a="<div class='dz-preview dz-file-preview col-xs-3 position-relative margin-bottom-10'><div class='dz-details'> <div class='dz-progress progress' style='width: 60px; top: 33px; left: 60%;' ><span class='progress-bar dz-upload' data-dz-uploadprogress></span></div><i class='fa fa-times-circle cursor upload-close font-size-h3' aria-hidden='true' data-dz-remove></i><div class='dz-image cursor position-relative'><img class='img-rounded' src='/img/tools/attached_file.png' width='68' height='68' data-dz-thumbnail /> <div class='kmong-KB-error-img'></div> </div><h6 class='text-justify ellipsis upload-title-text font-size-h5 upload-title-hover' style='left:22px;top: 45px; width: 55px !important;' data-dz-name></h6><h5 class='upload-title-text NGB' style='top: 15px; left:22px; width: 55px !important;' data-dz-size></h5><div class='dz-error-message-hover'><div class='dz-error-message upload-error' style='bottom:86px;' data-dz-errormessage></div><div class='upload-arrow' style='bottom: 80px;'></div></div></div><div class='dz-success-mark'><span></span></div> <div class='dz-error-mark'><span></span></div> </div></div>";helpCenterFile=new Dropzone("#kmongHelpCenter",{url:"/api/v4/help/upload",maxFilesize:5,thumbnailWidth:100,thumbnailHeight:100,parallelUploads:2,addRemoveLinks:!1,maxFiles:4,previewTemplate:a,autoQueue:!0,previewsContainer:".dropzone-preview-helpcenter",clickable:"#dropzoneFileHelp",dictCancelUpload:"",dictFileTooBig:"파일용량은 최대 5MB 입니다.",finit:function(){this.on("addedfile",function(e){if(master_vue.helpCenterForm.files.length){var t,i;for(t=0,i=master_vue.helpCenterForm.files.length;t<i-1;t++)master_vue.helpCenterForm.files[t].name===e.name&&this.removeFile(e)}})},success:function(e,t){master_vue.helpCenterForm.files.push({url:t.data.link_url,name:t.data.name}),e.id=t.data.id},maxfilesexceeded:function(e){this.removeFile(e)},removedfile:function(e){$(document).find(e.previewElement).remove(),master_vue.helpCenterForm.files.find(function(t,i){t.id==e.id&&master_vue.helpCenterForm.files.splice(i,1)})}})},watch:{"netPromoterScore.score":function(){$(".slider-handle").show(),$("#netPromoterScoreQuestionBtn").slideDown(500),$("#netPromoterScoreCloseBtn").hide()},"netPromoterScore.check":function(){},"netPromoterScore.message":function(){this.hideNetPromoterScoreError("message")},isLoggedIn:function(){this.isLoggedIn&&(this.getUnreadKmongNotifications(),this.checkSubjectOfNetPromoterScore())},"helpCenterForm.from_email":function(){""!=this.helpCenterForm.from_email.trim()&&this.hideHelpCenterError("from_email")},"helpCenterForm.title":function(){""!=this.helpCenterForm.title.trim()&&this.hideHelpCenterError("title")},"helpCenterForm.body":function(){""!=this.helpCenterForm.body.trim()&&this.hideHelpCenterError("body")},notifications:function(){$('[data-toggle="tooltip"]').tooltip(),$("#tabListDiv").length>0&&$("#tabListDiv").fadeIn("fast")},kmong_notifications:function(){if(this.kmong_notifications.length>0)for(var e in this.kmong_notifications){var t=this.kmong_notifications[e];if("object"==typeof t){var i="",o=[];if("KMONG"==t.provider&&(i=t.kmong_notification_data.message,o=t.kmong_notification_data.parameters),"COMMON"==t.provider&&(i=t.notification_message.data.message,o=t.notification_message.data.parameters),"undefined"!=typeof o)for(var n in o)if("object"==typeof o[n]&&"LINK"==o[n].type&&(i=findAndReplace(i,"*|"+o[n].name+"|*",o[n].text)),o.length-1==e)break;this.kmong_notifications[e].preview=i.replace(/(\r\n|\n|\r)/gm,"")}if(this.kmong_notifications.length-1==e)break}$(".kmong-KB-notification-list-group-item").on("click",function(){master_vue.selectedKmongNotification=null,master_vue.selectedIndex=-1,master_vue.getNextKmongNotification(0,$(this).data("index"))&&$("#kmongKnowledgeBaseCarousel").carousel(1)});var s=$("#kbCategoryBody"),r=$("#kmongNotifications");s.scroll(function(){r.hasClass("active")&&s[0].scrollHeight-s.scrollTop()<=s.outerHeight()&&(master_vue.kmongNotificationLoading||master_vue.kmongNotificationIsLastPage||master_vue.getKmongNotifications(void 0,master_vue.kmongNotificationCurrentPage))})},kb_query:function(){this.helpCenterForm.title=this.kb_query},selectedKmongNotification:function(){null!=this.selectedKmongNotification&&("KMONG"==this.selectedKmongNotification.provider&&"undefined"!=typeof this.selectedKmongNotification.kmong_notification_data.parameters&&(this.selectedKmongNotificationParameters=this.selectedKmongNotification.kmong_notification_data.parameters),"COMMON"==this.selectedKmongNotification.provider&&"undefined"!=typeof this.selectedKmongNotification.notification_message.data.parameters&&(this.selectedKmongNotificationParameters=this.selectedKmongNotification.notification_message.data.parameters))},kb_search_result:function(){var e=$("#kbCategoryHeader");this.kb_search_result.length>0?e.hide():e.show()},currentViewedGigs:function(){if(this.isFirstGetCurrentViewedGigs===!1){this.isFirstGetCurrentViewedGigs=!0;var e=196,t=199,i=5;currentViewGigsSlider=$("#currentViewGigsSlider").fSlider({autoplay:!1,arrowPrevClass:"currentViewGigsSliderLeft",arrowNextClass:"currentViewGigsSliderRight",loop:!1,dots:!1,setHeight:e,setWidth:t,numOfNextSlides:[i,i],slidesToShow:[i,i],responsive:!1,needRowClass:!1,totalSlideCount:Math.floor(master_vue.currentViewedGigs.length/i),additionalStyle:{"margin-left":"-3px","margin-right":"-3px",width:"calc(100% + 3px);"}}),$("#currentViewGigsSlider .sliderItem").show(),setTimeout(function(){$("#currentViewGigsSlider").css({"margin-left":"-3px","margin-right":"-3px",width:"calc(100% + 3px);"})},1e3),$('[data-toggle="tooltip"]').tooltip({html:!0})}this.isFirstGetCurrentViewedGigs===!0&&0===this.currentViewedGigs.length&&($("#currentViewedGigsBody").fadeOut(300),$("#currentViewedGigsContainer").fadeOut(300),$(".footer-body").removeClass("margin-top-50"))}},filters:{additionalNotificationParameter:function(e){return null==e||"null"==e?"":"?MID="+e},nl2br:function(e){return e.replace(/\n/g,"<br>")},parseString:function(e){if(null!=this.selectedKmongNotificationParameters)for(var t in this.selectedKmongNotificationParameters){if("object"==typeof this.selectedKmongNotificationParameters[t]&&"LINK"==this.selectedKmongNotificationParameters[t].type){var i=this.selectedKmongNotificationParameters[t].url;if("undefined"!=typeof i){i.indexOf("https")!=-1&&i.indexOf("http")!=-1||(i=i.indexOf("kmong.com")!=-1?"https://"+i:"http://"+i);var o='<a href="'+i+'"';"true"==this.selectedKmongNotificationParameters[t].is_external_link&&(o+=' target="_blank" '),o+=" >"+this.selectedKmongNotificationParameters[t].text+"</a>",e=findAndReplace(e,"*|"+this.selectedKmongNotificationParameters[t].name+"|*",o)}}if(this.selectedKmongNotificationParameters.length-1==t)break}return e},limit:function(e,t){return e.slice(0,t)},truncate:function(e,t){return e.substring(0,t)+"..."}},methods:{netPromoterScoreCheck:function(e){$("#netPromoterScoreMessageBody").slideDown(500),this.netPromoterScore.question_id=e},getNotifications:function(e){var t={page:this.page};$("#notificationLoadingImg").show();var i=$("#notificationsLoadMoreDiv");"loadMore"==e&&i.length>0&&createBallFall("#notificationsLoadMoreDiv","color-black"),this.$http.get("/api/v4/notification_items",t,null).then(function(t){this.notifications=this.notifications.concat(t.data.data.notification_items),this.unreadCnt=t.data.data.unreadCnt,this.buyUnreadCount=t.data.data.buyUnreadCount,this.sellUnreadCount=t.data.data.sellUnreadCount,this.gig_request_id=t.data.data.gig_request_id,this.page++,$("#notificationLoadingImg").hide(),this.isRequest=!1,this.is_lastPage=t.data.data.is_lastPage,"loadMore"==e&&i.length>0&&rollbackBallFall("#notificationsLoadMoreDiv","더보기")},null)},getKmongNotifications:function(e,t){if(!this.kmongNotificationsLoading&&!this.kmongNotificationIsLastPage){this.kmongNotificationsLoading=!0;var i=$("#kmongNotificationLoadingDiv");i.show(),t="undefined"!=typeof t?t:1,this.$http.get("/api/v4/kmong_notification_items",{page:t},null).then(function(t){if(this.kmong_notifications=this.kmong_notifications.concat(t.data.data.notification_items),this.kmongNotificationIsLastPage=t.data.data.is_lastPage,this.kmongNotificationCurrentPage++,this.kmongNotificationsLoading=!1,i.hide(),"undefined"!=typeof e){var o=this.findByNotificationId(e);return!(o==-1||!this.getNextKmongNotification(0,o))}},null)}},getNextKmongNotification:function(e,t){if(0==this.loadingNotification){if(this.selectedIndex+=parseInt(e),"undefined"!=typeof t&&(this.selectedIndex=parseInt(t)),this.selectedIndex<0)return this.selectedIndex=-1,!1;if(this.selectedIndex>this.kmong_notifications.length-1)return this.selectedIndex=this.kmong_notifications.length-1,!1;if(0==this.selectedIndex?$("#kmongNotificationNextBtn").hide():$("#kmongNotificationNextBtn").show(),this.selectedIndex==this.kmong_notifications.length-1?$("#kmongNotificationPrevBtn").hide():$("#kmongNotificationPrevBtn").show(),this.loadingNotification=!0,$("#kmongNotificationDetailLoadingBody").show(),$("#kmongNotificationDetailBody").hide(),"undefined"!=typeof this.kmong_notifications[this.selectedIndex])return 1==this.kmong_notifications[this.selectedIndex].unread&&this.setReadKmongNotification(this.selectedIndex),this.selectedKmongNotification=this.kmong_notifications[this.selectedIndex],setTimeout(function(){master_vue.loadingNotification=!1,$("#kmongNotificationDetailLoadingBody").fadeOut(400),$("#kmongNotificationDetailBody").fadeIn(400)},500),!0}return!1},getUnreadKmongNotifications:function(){this.$http.get("/api/v4/recently_unread_kmong_notification_item",null,null).then(function(e){null!=e.data.data.recetlyUnreadNotification&&(this.selectedKmongNotification=e.data.data.recetlyUnreadNotification,this.unreadKmongNotificationCount=e.data.data.unreadCount,this.isShowUnreadNotification=!0)},null)},getKnowledgeBaseCategories:function(){this.knowledge_bases.length>0||this.$http.get("/api/v4/knowledge_base_categories",null,null).then(function(e){this.knowledge_bases=e.data.data.kb_categories},null)},getKnowledgeBase:function(e){if(this.knowledge_bases.length>0)for(var t in this.knowledge_bases){var i=this.knowledge_bases[t];if("undefined"!=typeof i&&"undefined"!=typeof i.kb&&i.kb.length>0)for(var o in i.kb)if(i.kb[o].id==e){this.knowledge_base_detail=i.kb[o],$("#kmongKnowledgeBaseCarousel").carousel(2);break}}},searchKB:function(){this.kb_query.length<1||this.index.search(this.kb_query,function(e,t){$(".kb_search_bar").typeahead("close"),this.kb_search_result=t.hits}.bind(this))},openKmongKB:function(e){if(this.getKnowledgeBaseCategories(),1==this.isShowUnreadNotification&&null!=this.selectedKmongNotification&&this.unreadKmongNotificationCount>0&&($("#kmongNotificationLink").trigger("click"),0==this.kmong_notifications.length&&(this.getKmongNotifications(this.selectedKmongNotification.notification_id,this.kmongNotificationCurrentPage),$("#kmongKnowledgeBaseCarousel").carousel(1)),this.kmong_notifications.length>0)){var t=this.findByNotificationId(this.selectedKmongNotification.notification_id);t!=-1&&this.getNextKmongNotification(0,t)&&$("#kmongKnowledgeBaseCarousel").carousel(1)}$("#kmongKnowledgeBase").show(),$("#quickMenuFixed").css("z-index","99999")},openKmongKBByPenalty:function(e){if(null!=e){if($("#kmongNotificationLink").trigger("click"),0==this.kmong_notifications.length&&(this.getKmongNotifications(e,this.kmongNotificationCurrentPage),$("#kmongKnowledgeBaseCarousel").carousel(1)),this.kmong_notifications.length>0){var t=this.findByNotificationId(e);t!=-1&&this.getNextKmongNotification(0,t)&&$("#kmongKnowledgeBaseCarousel").carousel(1)}$("#kmongKnowledgeBase").show()}},findByNotificationId:function(e){if(this.kmong_notifications.length>0)for(var t in this.kmong_notifications){if("object"==typeof this.kmong_notifications[t]&&this.kmong_notifications[t].notification_id==e)return t;if(this.kmong_notifications.length-1==t)break}return-1},setReadKmongNotification:function(e){this.kmong_notifications[e].unread=0;var t={provider:this.kmong_notifications[e].provider,notification_id:this.kmong_notifications[e].notification_id};this.$http.post("/api/v4/set_read_notification",t,null).then(function(e){},null),this.isShowUnreadNotification=!1,this.unreadKmongNotificationCount--,this.unreadKmongNotificationCount<0&&(this.unreadKmongNotificationCount=0)},closeKmongKB:function(){var e=-1;if(this.kmong_notifications.length>0)for(var t in this.kmong_notifications){if("object"==typeof this.kmong_notifications[t]&&1==this.kmong_notifications[t].unread){e=t;break}if(this.kmong_notifications.length-1==t)break}e!=-1&&this.unreadKmongNotificationCount>0&&(this.selectedKmongNotification=this.kmong_notifications[e],this.selectedIndex=e,this.isShowUnreadNotification=!0),$("#kmongKnowledgeBase").hide(),$("#quickMenuFixed").css("z-index","93")},sendHelpCenterForm:function(){var e=!1,t="";for(var i in this.helpCenterForm)if("string"==typeof this.helpCenterForm[i]&&""==this.helpCenterForm[i].trim()?(e=!0,$("#helpCenter_"+i).addClass("has-error"),$("#helpCenter_"+i+"_error").show()):this.hideHelpCenterError(i),this.helpCenterForm.length-1==i)break;if(this.helpCenterForm.files.length>0){t+="[첨부된 파일]<br/><hr><br/>";for(var i in this.helpCenterForm.files)t+='<a href="'+this.helpCenterForm.files[i].url+'">'+this.helpCenterForm.files[i].name+"</a><br/>"}if(0==e){var o={body:this.helpCenterForm.body.replace(/\n/g,"<br>")+"<br/><br/>"+t,title:this.helpCenterForm.title,email:this.helpCenterForm.from_email};this.$http.post("/api/v4/help/new",o,null).then(function(e){this.helpCenterForm={from_email:this.helpCenterForm.from_email,title:"",body:"",files:[]},this.kb_query="",sweetalert("문의가 접수되었습니다!","빠른 시일 내에 답변해드리도록 하겠습니다.","success")},null)}},hideHelpCenterError:function(e){$("#helpCenter_"+e).removeClass("has-error"),$("#helpCenter_"+e+"_error").hide()},arrowToggle:function(e){var t=$("#arrowToggle_"+e+" > i"),i=t.hasClass("fa-rotate-180");i?t.removeClass("fa-rotate-180"):t.addClass("fa-rotate-180")},initializeSearchInput:function(){this.kb_search_result=[],this.kb_query=""},checkSubjectOfNetPromoterScore:function(){this.$http.get("/api/v4/check_subject_of_net_promoter_score",null,null).then(function(e){this.isShowNetPromoterScoreSurvey=e.data.meta.status},null)},showNetPromoterScoreError:function(e){var t="#netPromoterScore"+e[0].toUpperCase()+e.substring(1);$(t).parent().addClass("has-error"),$(t).siblings().each(function(){$(this).hasClass("help-block")&&$(this).show()})},hideNetPromoterScoreError:function(e){var t="#netPromoterScore"+e[0].toUpperCase()+e.substring(1);$(t).parent().removeClass("has-error"),$(t).siblings().each(function(){$(this).hasClass("help-block")&&$(this).hide()})},setNetPromoterScore:function(e){if("save"==e){var t=!1;if(this.netPromoterScore.score==-1&&(this.showNetPromoterScoreError("score"),t=!0),1==t)return!1}createBallFall("#sendNetPromoterScoreBtn");var i={type:e,score:this.netPromoterScore.score,message:this.netPromoterScore.message,question_id:this.netPromoterScore.question_id};"dismiss"==e&&(this.isShowNetPromoterScoreSurvey=-1),this.$http.post("/api/v4/set_net_promoter_score",i,null).then(function(t){1===t.data.meta.status&&"save"==e&&(this.isShowNetPromoterScoreSurvey=2,setTimeout(function(){hideNetPromoterScoreBody()},1500))},function(e){"undefined"!=typeof e.data.meta.errors.alert&&($("#resultMessage").html(e.data.meta.errors.alert),this.isShowNetPromoterScoreSurvey=2,setTimeout(function(){hideNetPromoterScoreBody()},1500))})},setCurrentViewedGig:function(e){try{var t=getCookie("CURRENT_VIEWED_GIGS"),i=[];if(""!=t&&(i=JSON.parse(t),i.length>0))for(var o in i)if(i[o].PID==e.PID){i.splice(o,1);break}20==i.length&&i.splice(0,1),i.push(e),setCookie("CURRENT_VIEWED_GIGS",JSON.stringify(i),365)}catch(n){}},getCurrentViewGigs:function(){try{var e=getCookie("CURRENT_VIEWED_GIGS");if(""!==e&&"object"==typeof JSON.parse(e)){e=JSON.parse(e),e=Object.keys(e).map(function(t){return e[t]});for(var t in e)e[t].main_image="https://d2v80xjmx68n4w.cloudfront.net/gigs/small/"+e[t].main_image;e.length>0&&(this.currentViewedGigs=e)}}catch(i){}},removeCurrentViewGigs:function(e,t){e.stopPropagation();var i=$(".recent-view-list");try{if("all"==t)setCookie("CURRENT_VIEWED_GIGS","",365),i.addClass("animated fadeOutDown"),setTimeout(function(){master_vue.currentViewedGigs=[]},500);else{if(this.currentViewedGigs.length>0)for(var o in this.currentViewedGigs)if(this.currentViewedGigs[o].PID==t){if($("#currentViewedGig_"+o).addClass("fade-out"),i.each(function(e,t){e>o&&$(this).animate({left:"-199px"},500,function(){if($(t).css("left",0),e==i.length-1){if($("#currentViewedGig_"+o).hasClass("current")){var n=parseInt(o)+1;$("#currentViewedGig_"+n).addClass("current")}if(master_vue.currentViewedGigs.splice(o,1),null!=currentViewGigsSlider){var s=Math.floor(master_vue.currentViewedGigs.length/5);currentViewGigsSlider[0].fSlider.totalSlides=master_vue.currentViewedGigs.length,currentViewGigsSlider[0].fSlider.totalNextSlideEventCount=s,currentViewGigsSlider[0].fSlider.totalPrevSlideEventCount=s,0===s&&$("currentViewGigsSliderArrow").hide()}}})}),o==i.length-1&&(master_vue.currentViewedGigs.splice(o,1),null!=currentViewGigsSlider)){var n=Math.floor(master_vue.currentViewedGigs.length/5);currentViewGigsSlider[0].fSlider.totalSlides=master_vue.currentViewedGigs.length,currentViewGigsSlider[0].fSlider.totalNextSlideEventCount=n,currentViewGigsSlider[0].fSlider.totalPrevSlideEventCount=n,currentViewGigsSlider[0].fSlider.curSlideNum>=currentViewGigsSlider[0].fSlider.totalSlides&&$(".currentViewGigsSliderLeft").trigger("click"),0===n&&$("currentViewGigsSliderArrow").hide()}break}var s=getCookie("CURRENT_VIEWED_GIGS"),r=[];if(""!=s&&(r=JSON.parse(s),r.length>0))for(var o in r)if(r[o].PID==t){r.splice(o,1);break}setCookie("CURRENT_VIEWED_GIGS",JSON.stringify(r),365)}}catch(a){}},changePageBuyerVideoIndex:function(e){this.isAnimatingBuyerVideoCarousel===!1&&(this.isAnimatingBuyerVideoCarousel=!0,$("#buyerVideoCarousel").carousel(e))}}});